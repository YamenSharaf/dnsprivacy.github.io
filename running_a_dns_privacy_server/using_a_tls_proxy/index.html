<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.86.0" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Using a TLS proxy :: dnsprivacy.org</title>

    
    <link href="/css/nucleus.css?1630059336" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1630059336" rel="stylesheet">
    <link href="/css/hybrid.css?1630059336" rel="stylesheet">
    <link href="/css/featherlight.min.css?1630059336" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1630059336" rel="stylesheet">
    <link href="/css/auto-complete.css?1630059336" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1630059336" rel="stylesheet">
    <link href="/css/theme.css?1630059336" rel="stylesheet">
    <link href="/css/tabs.css?1630059336" rel="stylesheet">
    <link href="/css/hugo-theme.css?1630059336" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1630059336" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1630059336"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/running_a_dns_privacy_server/using_a_tls_proxy/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/'>
  <p style="color: #fafafa;font-size:36px;font-weight: 400;">DNS Privacy Project</p>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1630059336"></script>
<script type="text/javascript" src="/js/auto-complete.js?1630059336"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/dnsprivacy.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1630059336"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/the_problem/" title="The Problem" class="dd-item
        
        
        
        ">
      <a href="/the_problem/">
          1. The Problem
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/the_solutions/" title="The Solutions" class="dd-item
        
        
        
        ">
      <a href="/the_solutions/">
          2. The Solutions
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/current_work/" title="Current Work" class="dd-item
        
        
        
        ">
      <a href="/current_work/">
          3. Current Work
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ietf_dns_privacy_tutorial/" title="IETF DNS Privacy Tutorial" class="dd-item
        
        
        
        ">
      <a href="/ietf_dns_privacy_tutorial/">
          4. IETF DNS Privacy Tutorial
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/public_resolvers/" title="Public Resolvers" class="dd-item
        
        
        
        ">
      <a href="/public_resolvers/">
          5. Public Resolvers
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/test_servers/" title="Test Servers" class="dd-item
        
        
        
        ">
      <a href="/test_servers/">
          6. Test Servers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/test_servers/map_of_test_server_locations/" title="Map of test server locations" class="dd-item ">
        <a href="/test_servers/map_of_test_server_locations/">
        6.1. Map of test server locations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/test_servers/monitoring/" title="dnsprivacy Monitoring" class="dd-item ">
        <a href="/test_servers/monitoring/">
        6.2. dnsprivacy Monitoring
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/test_servers/live_traffic_levels/" title="Live Traffic Levels" class="dd-item ">
        <a href="/test_servers/live_traffic_levels/">
        6.2. Live Traffic Levels
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dns_privacy_clients/" title="DNS Privacy Clients" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_clients/">
          7. DNS Privacy Clients
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dns_privacy_daemon_-_stubby/" title="DNS Privacy Daemon - Stubby" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_daemon_-_stubby/">
          8. DNS Privacy Daemon - Stubby
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/about_stubby/" title="About Stubby" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/about_stubby/">
        8.1. About Stubby
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/configuring_stubby/" title="Configuring Stubby" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/configuring_stubby/">
        8.2. Configuring Stubby
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/stubby_manager_gui/" title="Stubby Manager GUI" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/stubby_manager_gui/">
        8.3. Stubby Manager GUI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/" title="Installation" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_daemon_-_stubby/installation/">
          8.4. Installation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/linux_from_source/" title="Linux From Source" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/linux_from_source/">
        8.4.1. Linux From Source
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/running_as_a_service_on_nix/" title="Running as a service on *nix" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/running_as_a_service_on_nix/">
        8.4.2. Running as a service on *nix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/macos_homebrew/" title="MacOS Homebrew" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/macos_homebrew/">
        8.4.3. MacOS Homebrew
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/stubby_gui_for_macos/" title="Stubby GUI for macOS" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/stubby_gui_for_macos/">
        8.4.4. Stubby GUI for macOS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dns_privacy_daemon_-_stubby/installation/windows_installer_for_stubby/" title="Windows installer for Stubby" class="dd-item ">
        <a href="/dns_privacy_daemon_-_stubby/installation/windows_installer_for_stubby/">
        8.4.5. Windows installer for Stubby
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/implementation_status/" title="Implementation Status" class="dd-item
        
        
        
        ">
      <a href="/implementation_status/">
          9. Implementation Status
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/" title="Running a DNS Privacy server" class="dd-item
        parent
        
        
        ">
      <a href="/running_a_dns_privacy_server/">
          10. Running a DNS Privacy server
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_unbound/" title="Using Unbound" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_unbound/">
        10.1. Using Unbound
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_knot_resolver/" title="Using Knot Resolver" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_knot_resolver/">
        10.2. Using Knot Resolver
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_dnsdist/" title="Using dnsdist" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_dnsdist/">
        10.3. Using dnsdist
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/using_a_tls_proxy/" title="Using a TLS proxy" class="dd-item
        parent
        active
        
        ">
      <a href="/running_a_dns_privacy_server/using_a_tls_proxy/">
          10.4. Using a TLS proxy
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/using_a_tls_proxy/building_haproxy_using_tlsv1_3/" title="Building HAProxy using TLSv1.3" class="dd-item ">
        <a href="/running_a_dns_privacy_server/using_a_tls_proxy/building_haproxy_using_tlsv1_3/">
        10.4.1. Building HAProxy using TLSv1.3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/" title="Let&#39;s Encrypt Certificate renewal" class="dd-item
        
        
        
        ">
      <a href="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/">
          10.5. Let&#39;s Encrypt Certificate renewal
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_1/" title="Certificate management Method 1" class="dd-item ">
        <a href="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_1/">
        10.5.1. Certificate management Method 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_2/" title="Certificate management method 2" class="dd-item ">
        <a href="/running_a_dns_privacy_server/lets_encrypt_certificate_renewal/automated_certificate_management_2/">
        10.5.2. Certificate management method 2
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/monitoring_privacy_servers/" title="Monitoring Privacy servers" class="dd-item ">
        <a href="/running_a_dns_privacy_server/monitoring_privacy_servers/">
        10.6. Monitoring Privacy servers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/running_a_dns_privacy_server/best_current_practices/" title="Best Current Practices" class="dd-item
        
        
        
        ">
      <a href="/running_a_dns_privacy_server/best_current_practices/">
          10.7. Best Current Practices
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/best_current_practices/comparison_of_policy_and_privacy_statements_2019/" title="Comparison of policy and privacy statements 2019" class="dd-item ">
        <a href="/running_a_dns_privacy_server/best_current_practices/comparison_of_policy_and_privacy_statements_2019/">
        10.7.1. Comparison of policy and privacy statements 2019
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/running_a_dns_privacy_server/best_current_practices/data_minimisation_of_dns_traffic/" title="Data minimisation of DNS traffic" class="dd-item ">
        <a href="/running_a_dns_privacy_server/best_current_practices/data_minimisation_of_dns_traffic/">
        10.7.2. Data minimisation of DNS traffic
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dns_privacy_reference_material/" title="DNS Privacy Reference Material" class="dd-item
        
        
        
        ">
      <a href="/dns_privacy_reference_material/">
          11. DNS Privacy Reference Material
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/dnsprivacy"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://twitter.com/DNSPrivacyProj"><i class='fab fa-twitter'></i> Twitter</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.youtube.com/channel/UCaJWMY-m9ktZIbUNMi0Eh9g/playlists"><i class='fab fa-youtube'></i> YouTube</a>
              </li>
          
              <li>
                  <a class="padding" href="https://sinodun.com"><i class='fas fa-bookmark'></i> Sinodun IT</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.nlnetlabs.nl/"><i class='fas fa-bookmark'></i> NLnetLabs</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn">Hugo Theme Learn</a> and <a href="https://gohugo.io/">Hugo</a></p>
<p>Built by <a href="sinodun.com">Sinodun Internet Technologies.</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>DNS Privacy Project</a> > <a href='/running_a_dns_privacy_server/'>Running a DNS Privacy server</a> > Using a TLS proxy
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        



	<h1 id="how-to-use-a-tls-proxy-with-a-dns-nameserver">How to use a TLS proxy with a DNS nameserver</h1>
<p>It is of course possible to configure a TLS proxy in front of a DNS
nameserver to provide DNS-over-TLS. Example configurations for nginx and
haproxy are given here.</p>

<div class="notices infoblock" ><p>A more comprehensive setup guide using Docker has been provided by
Warren
Kumari: <a href="https://github.com/wkumari/dprive-nginx-bind">dprive-nginx-bind</a>
(Thanks Warren!)</p>
</div>

<h2 id="limitations">Limitations</h2>
<p>One of the limitations of using a proxy is that without additional work
this will normally mean that the client address is not visible to the
nameserver, which can cause issues with NAT64, RRL, RPZ etc.  There are
ways round this using address re-write rules but we don&rsquo;t detail that
here. In future a solution
like <a href="https://datatracker.ietf.org/doc/draft-bellis-dnsop-xpf/">https://datatracker.ietf.org/doc/draft-bellis-dnsop-xpf/</a> might
become standard. </p>
<h2 id="nameserver-config">Nameserver config</h2>
<p>To use the following with BIND to offer a TLS service, configure BIND
based on the following named.conf snippet</p>
<ul>
<li>This assumes BIND 9.12 which supports response padding (comment that
line out if you are using an earlier version)</li>
<li>The rncd and logging config is used to capture traffic volume
stats - statistics can be dumped periodically with the &lsquo;rndc stats&rsquo;
command</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">options <span style="color:#f92672">{</span>
    directory <span style="color:#e6db74">&#34;/home/sinodun&#34;</span><span style="color:#f92672">;</span>
    listen<span style="color:#f92672">-</span>on port 9999 <span style="color:#f92672">{</span> 127<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">;</span> <span style="color:#f92672">};</span>
    allow<span style="color:#f92672">-</span>query <span style="color:#f92672">{</span> 127<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">;</span> <span style="color:#f92672">};</span>
    tcp<span style="color:#f92672">-</span>clients 4000<span style="color:#f92672">;</span>
    statistics<span style="color:#f92672">-</span>file <span style="color:#e6db74">&#34;/tmp/bind-stats&#34;</span><span style="color:#f92672">;</span>
    dnssec<span style="color:#f92672">-</span>enable yes<span style="color:#f92672">;</span>
    dnssec<span style="color:#f92672">-</span>validation auto<span style="color:#f92672">;</span>
    response<span style="color:#f92672">-</span>padding <span style="color:#f92672">{</span> any<span style="color:#f92672">;</span> <span style="color:#f92672">}</span> block<span style="color:#f92672">-</span>size 468<span style="color:#f92672">;</span>
<span style="color:#f92672">};</span>
</code></pre></div><p>Use with the following in named.conf, adjusting the allow list as needed:</p>
<pre><code>key &quot;rndc-key&quot; {
    algorithm hmac-md5;
    secret &quot;BIGSECRET&quot;;
};
 
controls {
    inet 127.0.0.1 port 9953
        allow { 127.0.0.1; } keys { &quot;rndc-key&quot;; };
};

logging {
    category default { null; };
    category unmatched { null; };
};
</code></pre><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="nginxconf">nginx.conf</h2>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">user www<span style="color:#f92672">-</span>data<span style="color:#f92672">;</span>
worker_processes auto<span style="color:#f92672">;</span>
pid <span style="color:#f92672">/</span>run<span style="color:#f92672">/</span>nginx<span style="color:#f92672">.</span><span style="color:#a6e22e">pid</span><span style="color:#f92672">;</span>

events <span style="color:#f92672">{</span>
worker_connections 1024<span style="color:#f92672">;</span>
<span style="color:#960050;background-color:#1e0010">#</span> multi_accept on<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

stream <span style="color:#f92672">{</span>
upstream dns_tcp_servers <span style="color:#f92672">{</span>
server 127<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">:</span>9999<span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>

server <span style="color:#f92672">{</span>
listen 853 ssl<span style="color:#f92672">;</span>
proxy_pass dns_tcp_servers<span style="color:#f92672">;</span>

   ssl_certificate       <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>lego<span style="color:#f92672">/</span>certificates<span style="color:#f92672">/&lt;</span>cert<span style="color:#f92672">&gt;.</span><span style="color:#a6e22e">crt</span><span style="color:#f92672">;</span>
   ssl_certificate_key   <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>nginx<span style="color:#f92672">/</span>lego<span style="color:#f92672">/</span>certificates<span style="color:#f92672">/&lt;</span>cert<span style="color:#f92672">&gt;.</span><span style="color:#a6e22e">key</span><span style="color:#f92672">;</span>
   ssl_protocols         TLSv1<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">;</span>
   ssl_ciphers           ECDHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES256<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA384<span style="color:#f92672">:</span>ECDHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES128<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA256<span style="color:#f92672">:</span>DHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES128<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA256<span style="color:#f92672">:</span>DHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES256<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA384<span style="color:#f92672">;</span>
   ssl_session_tickets on<span style="color:#f92672">;</span>
   ssl_session_timeout   4h<span style="color:#f92672">;</span>
   ssl_handshake_timeout 30s<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="haproxycfg">haproxy.cfg</h2>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">global
log <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>log local0
chroot <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>haproxy
user haproxy
group haproxy
maxconn 1024
pidfile <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>run<span style="color:#f92672">/</span>haproxy<span style="color:#f92672">.</span><span style="color:#a6e22e">pid</span>
nbproc <span style="color:#f92672">&lt;</span>processes<span style="color:#f92672">&gt;</span>
tune<span style="color:#f92672">.</span><span style="color:#a6e22e">ssl</span><span style="color:#f92672">.</span><span style="color:#a6e22e">default</span><span style="color:#f92672">-</span>dh<span style="color:#f92672">-</span>param 2048
ssl<span style="color:#f92672">-</span><span style="color:#66d9ef">default</span><span style="color:#f92672">-</span>bind<span style="color:#f92672">-</span>ciphers ECDHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES256<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA384<span style="color:#f92672">:</span>ECDHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES128<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA256<span style="color:#f92672">:</span>DHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES128<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA256<span style="color:#f92672">:</span>DHE<span style="color:#f92672">-</span>RSA<span style="color:#f92672">-</span>AES256<span style="color:#f92672">-</span>GCM<span style="color:#f92672">-</span>SHA384
ssl<span style="color:#f92672">-</span><span style="color:#66d9ef">default</span><span style="color:#f92672">-</span>bind<span style="color:#f92672">-</span>options force<span style="color:#f92672">-</span>tlsv12

   <span style="color:#960050;background-color:#1e0010">#</span> Default SSL material locations
   ca<span style="color:#f92672">-</span>base <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>ssl<span style="color:#f92672">/</span>certs
   crt<span style="color:#f92672">-</span>base <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>ssl<span style="color:#f92672">/</span><span style="color:#66d9ef">private</span>
defaults
balance roundrobin
timeout http<span style="color:#f92672">-</span>request 10s
timeout queue 1m
timeout connect 10s
timeout client 1m
timeout server 1m
timeout check 10s

listen dns
bind 145<span style="color:#f92672">.</span><span style="color:#a6e22e">100</span><span style="color:#f92672">.</span><span style="color:#a6e22e">185</span><span style="color:#f92672">.</span><span style="color:#a6e22e">15</span><span style="color:#f92672">:</span>853 ssl crt <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>haproxy<span style="color:#f92672">/</span>lego<span style="color:#f92672">/</span>certificates<span style="color:#f92672">/&lt;</span>cert<span style="color:#f92672">&gt;.</span><span style="color:#a6e22e">pem</span>
mode tcp
server server1 127<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">:</span>9999
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>For all but lightly loaded systems, you will need to tune the number of
processes or threads available to HAProxy. Unlike the nginx
configuration above, which specifies an automatic configuration of the
number of worker processes, HAProxy needs to have these quantities set
by hand. The simplest way is to set configuration item <code>nbproc</code> to an
appropriate number; we suggest the number of threads or processes used
by the nameserver. For more advanced tuning options, including setting
CPU affinity, see the HAProxy documentation or <a href="https://www.haproxy.com/blog/multithreading-in-haproxy/">this blog
post</a>.</p>
<p>If you use HAProxy and have generated your certificates from Let&rsquo;s
Encrypt then you need to combine the certificate chain and key into one
file using a command similar to:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">cat  <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>letsencrypt<span style="color:#f92672">/</span>certs<span style="color:#f92672">/</span>000<span style="color:#f92672">&lt;</span>N<span style="color:#f92672">&gt;</span>_chain<span style="color:#f92672">.</span><span style="color:#a6e22e">pem</span> <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>letsencrypt<span style="color:#f92672">/</span>keys<span style="color:#f92672">/&lt;</span>my_key<span style="color:#f92672">&gt;.</span><span style="color:#a6e22e">key</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>letsencrypt<span style="color:#f92672">/</span>certs<span style="color:#f92672">/&lt;</span>cert<span style="color:#f92672">&gt;.</span><span style="color:#a6e22e">pem</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->





<footer class=" footline" >
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1630059336"></script>
    <script src="/js/perfect-scrollbar.min.js?1630059336"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1630059336"></script>
    <script src="/js/jquery.sticky.js?1630059336"></script>
    <script src="/js/featherlight.min.js?1630059336"></script>
    <script src="/js/highlight.pack.js?1630059336"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1630059336"></script>
    <script src="/js/learn.js?1630059336"></script>
    <script src="/js/hugo-learn.js?1630059336"></script>
    
    

  </body>
</html>
